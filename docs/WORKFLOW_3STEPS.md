# 독립성 검토 워크플로우 (질문 입력 → 답변)

## 전체 흐름 (순차)

| 순서 | 단계 | 백엔드 동작 | 산출물 |
|------|------|-------------|--------|
| 1 | 관계 추출 | `extract_relationships(scenario)` — 1차 LLM 호출 | 엔티티·관계 맵(JSON) |
| 2 | 독립성 분석 | `analyze_independence(scenario, rel_map)` — 2차 LLM 호출 | 수임 여부, 이슈, 안전장치, 법령 |
| 3 | 보고서 생성 | `_enrich_legal_ref_urls` + `build_mermaid_graph` + (선택) Neo4j 저장 | 결론·다이어그램·법령 링크가 포함된 응답 |
| - | 프론트 | POST 응답 수신 → 카드 렌더 → Mermaid 클라이언트 렌더 | 화면 표시 |

---

## 프로그레스 표시용 3단계 (굵직 구분)

프로그레스바/로딩 문구에 쓸 3단계는 아래처럼 나누면 됩니다.

| 단계 | 표출 문구 (한 줄) | 설명 |
|------|-------------------|------|
| **1단계** | **관계 추출** — 시나리오에서 인물·회사·관계 구조를 추출하고 있습니다. | 1차 LLM: 시나리오 텍스트 → 구조화된 엔티티·관계 맵 |
| **2단계** | **독립성 분석** — 추출된 구조를 바탕으로 수임 가능성과 위험을 판단하고 있습니다. | 2차 LLM: 맵 + 시나리오 → 수임 여부, 이슈, 안전장치, 근거 법령 |
| **3단계** | **보고서 생성** — 결론, 관계도, 법령 링크를 정리해 보고서를 만들고 있습니다. | 법령 URL 보강, Mermaid 코드 생성, (선택) Neo4j 저장, 응답 반환 후 프론트 렌더 |

---

## 표출 문구만 복사용 (UI에 넣을 때)

```
1. 관계 추출 — 시나리오에서 인물·회사·관계 구조를 추출하고 있습니다.
2. 독립성 분석 — 추출된 구조를 바탕으로 수임 가능성과 위험을 판단하고 있습니다.
3. 보고서 생성 — 결론, 관계도, 법령 링크를 정리해 보고서를 만들고 있습니다.
```

**생성형 AI 전문가 관점 요약**
- **1단계**: 입력(시나리오) → 구조화(추출) — “무엇이 누구와 어떤 관계인가”
- **2단계**: 구조 + 맥락 → 판단(분석) — “독립성 관점에서 수임 가능한가, 이슈·안전장치는 무엇인가”
- **3단계**: 판단 결과 → 사용자용 출력(보고서) — “결론·시각화·근거를 한 번에 전달”
