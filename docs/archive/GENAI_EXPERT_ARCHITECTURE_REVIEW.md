# ìƒì„±í˜• AI ì „ë¬¸ê°€ ê´€ì  ì•„í‚¤í…ì²˜ ê²€í† 

**ì‘ì„±ì¼**: 2026-02-12  
**ê²€í† ì**: ìƒì„±í˜• AI ì „ë¬¸ê°€ ê´€ì   
**ê²€í†  ëª©ì **: ì˜ë„ëœ ì•„í‚¤í…ì²˜ vs ì‹¤ì œ êµ¬í˜„ ë¹„êµ ë¶„ì„

---

## ğŸ“‹ ì‚¬ìš©ì ì˜ë„

### ì˜ë„ëœ íë¦„

```
[chat] ì‹œë‚˜ë¦¬ì˜¤ ì…ë ¥ 
  â†’ [llm_1st] ì—”í‹°í‹°-ê´€ê³„ ì¶”ì¶œ 
    â†’ ì¶”ì¶œëœ [ì—”í‹°í‹°-ê´€ê³„] ì •ë³´ë¥¼ 
      â†’ [llm_2nd] (chat)ì˜ í”„ë¡¬í”„íŠ¸ [context]ë¡œ í™œìš©
```

**í•µì‹¬**: ì—”í‹°í‹°-ê´€ê³„ ì¶”ì¶œ ê²°ê³¼ê°€ ì¼ë°˜ ì±„íŒ…(`/chat`)ì˜ ì»¨í…ìŠ¤íŠ¸ë¡œ í™œìš©ë˜ì–´ì•¼ í•¨

---

## ğŸ” í˜„ì¬ êµ¬í˜„ ìƒíƒœ ë¶„ì„

### 1. ì‹¤ì œ ì½”ë“œ íë¦„

#### `/chat/completions` ì—”ë“œí¬ì¸íŠ¸
```python
# backend/routers/chat.py
@router.post("/completions")
def chat_completion(request: ChatRequest):
    reply = get_llm_response(
        messages=[{"role": m.role, "content": m.content} for m in request.messages],
        stream=request.stream,
    )
    return {"message": ChatMessage(role="assistant", content=reply)}
```

**ë¶„ì„**:
- âœ… ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ê·¸ëŒ€ë¡œ OpenAIì— ì „ë‹¬
- âŒ ì—”í‹°í‹°-ê´€ê³„ ì •ë³´ë¥¼ contextë¡œ í™œìš©í•˜ì§€ ì•ŠìŒ
- âŒ `independence_service`ì™€ ì—°ê²° ì—†ìŒ

#### `/independence/review` ì—”ë“œí¬ì¸íŠ¸
```python
# backend/routers/independence.py
@router.post("/review")
async def post_independence_review(body: IndependenceReviewRequest):
    result = await run_independence_review(body.scenario.strip(), save_to_neo4j=True)
    return result
```

**ë¶„ì„**:
- âœ… `extract_relationships`ë¡œ ì—”í‹°í‹°-ê´€ê³„ ì¶”ì¶œ
- âœ… `analyze_independence`ì—ì„œ ì¶”ì¶œ ê²°ê³¼ë¥¼ í”„ë¡¬í”„íŠ¸ì— í¬í•¨
- âŒ í•˜ì§€ë§Œ `/chat`ê³¼ ì™„ì „íˆ ë¶„ë¦¬ëœ ë…ë¦½ì ì¸ íŒŒì´í”„ë¼ì¸

### 2. ì„œë¹„ìŠ¤ ë ˆì´ì–´ ë¶„ë¦¬ ìƒíƒœ

| ì„œë¹„ìŠ¤ | ì—­í•  | ì—”í‹°í‹°-ê´€ê³„ í™œìš© |
|--------|------|-----------------|
| `llm_service` | ì¼ë°˜ ì±„íŒ… (ë¹„êµ¬ì¡°í™”) | âŒ í™œìš© ì•ˆ í•¨ |
| `independence_service` | ì¶”ì¶œ â†’ ë¶„ì„ | âœ… ë‚´ë¶€ì ìœ¼ë¡œë§Œ í™œìš© |
| `llm_structured` | êµ¬ì¡°ì  ì¶œë ¥ | âœ… independence_serviceì—ì„œë§Œ ì‚¬ìš© |

---

## âš ï¸ ë°œê²¬ëœ ë¬¸ì œì 

### ë¬¸ì œ 1: ì•„í‚¤í…ì²˜ ë¶„ë¦¬

**í˜„ì¬ ìƒíƒœ**:
```
/chat â†’ llm_service â†’ OpenAI (ë…ë¦½ì )
/independence â†’ independence_service â†’ llm_structured â†’ OpenAI (ë…ë¦½ì )
```

**ì˜ë„ëœ ìƒíƒœ**:
```
/chat â†’ [ì—”í‹°í‹°-ê´€ê³„ ì¶”ì¶œ] â†’ llm_service (context í¬í•¨) â†’ OpenAI
```

### ë¬¸ì œ 2: Context ì „ë‹¬ ê²½ë¡œ ë¶€ì¬

**í˜„ì¬**:
- `extract_relationships()` ê²°ê³¼ê°€ `analyze_independence()`ì—ë§Œ ì „ë‹¬ë¨
- `get_llm_response()`ëŠ” ì—”í‹°í‹°-ê´€ê³„ ì •ë³´ë¥¼ ë°›ì§€ ì•ŠìŒ

**í•„ìš”**:
- ì—”í‹°í‹°-ê´€ê³„ ì¶”ì¶œ ê²°ê³¼ê°€ `get_llm_response()`ì˜ í”„ë¡¬í”„íŠ¸ì— contextë¡œ í¬í•¨ë˜ì–´ì•¼ í•¨

### ë¬¸ì œ 3: ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì˜ ì •í™•ì„±

**ë‹¤ì´ì–´ê·¸ë¨ ìƒíƒœ**: âœ… **ì‹¤ì œ êµ¬í˜„ì„ ì •í™•íˆ ë°˜ì˜**

- ë‹¤ì´ì–´ê·¸ë¨ì´ ì˜ëª» ê·¸ë ¤ì§„ ê²ƒì´ ì•„ë‹˜
- ë‹¤ì´ì–´ê·¸ë¨ì€ í˜„ì¬ êµ¬í˜„ì„ ì •í™•íˆ í‘œí˜„í•¨
- **ë¬¸ì œëŠ” êµ¬í˜„ì´ ì˜ë„ì™€ ë‹¤ë¦„**

---

## ğŸ“Š ë¹„êµ ë¶„ì„

### ì˜ë„ vs êµ¬í˜„

| í•­ëª© | ì˜ë„ | í˜„ì¬ êµ¬í˜„ | ì¼ì¹˜ ì—¬ë¶€ |
|------|------|-----------|----------|
| **ì—”í‹°í‹°-ê´€ê³„ ì¶”ì¶œ** | âœ… í•„ìš” | âœ… `extract_relationships()` ì¡´ì¬ | âœ… |
| **Context í™œìš©** | âœ… chatì—ì„œ í™œìš© | âŒ chatì—ì„œ í™œìš© ì•ˆ í•¨ | âŒ |
| **íŒŒì´í”„ë¼ì¸ í†µí•©** | âœ… í†µí•©ëœ íë¦„ | âŒ ë¶„ë¦¬ëœ íŒŒì´í”„ë¼ì¸ | âŒ |
| **llm_1st â†’ llm_2nd ì—°ê²°** | âœ… ì—°ê²° í•„ìš” | âŒ ì—°ê²° ì—†ìŒ | âŒ |

---

## ğŸ¯ í•´ê²° ë°©ì•ˆ ì œì•ˆ

### ì˜µì…˜ A: `/chat` ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì • (ê¶Œì¥)

**ì ‘ê·¼**: `/chat`ì—ì„œ ì—”í‹°í‹°-ê´€ê³„ ì¶”ì¶œ í›„ contextë¡œ í™œìš©

**êµ¬í˜„ ë°©ì•ˆ**:
```python
@router.post("/completions")
async def chat_completion(request: ChatRequest):
    # 1. ì—”í‹°í‹°-ê´€ê³„ ì¶”ì¶œ
    rel_map = await extract_relationships(request.messages[-1].content)
    
    # 2. Context êµ¬ì„±
    context = f"""
    ë‹¤ìŒì€ ì…ë ¥ëœ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì¶”ì¶œí•œ ì—”í‹°í‹°-ê´€ê³„ ì •ë³´ì…ë‹ˆë‹¤:
    {rel_map.model_dump_json(indent=2)}
    
    ì´ ì •ë³´ë¥¼ ì°¸ê³ í•˜ì—¬ ë‹µë³€í•´ì£¼ì„¸ìš”.
    """
    
    # 3. Contextë¥¼ í¬í•¨í•œ ë©”ì‹œì§€ êµ¬ì„±
    enhanced_messages = [
        {"role": "system", "content": "ë‹¹ì‹ ì€ ê°ì‚¬ ë…ë¦½ì„± ê²€í†  ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì œê³µëœ ì—”í‹°í‹°-ê´€ê³„ ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ ë‹µë³€í•˜ì„¸ìš”."},
        {"role": "user", "content": context + "\n\n" + request.messages[-1].content}
    ]
    
    # 4. LLM í˜¸ì¶œ
    reply = get_llm_response(messages=enhanced_messages, stream=request.stream)
    return {"message": ChatMessage(role="assistant", content=reply)}
```

**ì¥ì **:
- ì˜ë„í•œ íë¦„ êµ¬í˜„
- ê¸°ì¡´ ì½”ë“œ ìµœì†Œ ë³€ê²½
- ì—”í‹°í‹°-ê´€ê³„ ì •ë³´ í™œìš©

**ë‹¨ì **:
- ë§¤ë²ˆ ì¶”ì¶œ ìˆ˜í–‰ìœ¼ë¡œ ì§€ì—° ì¦ê°€
- ë¹„ìš© ì¦ê°€ ê°€ëŠ¥

### ì˜µì…˜ B: ì„¸ì…˜ ê¸°ë°˜ Context ê´€ë¦¬

**ì ‘ê·¼**: ì„¸ì…˜ë³„ë¡œ ì—”í‹°í‹°-ê´€ê³„ ì¶”ì¶œ ê²°ê³¼ë¥¼ ìºì‹±

**êµ¬í˜„ ë°©ì•ˆ**:
```python
# ì„¸ì…˜ë³„ ì¶”ì¶œ ê²°ê³¼ ì €ì¥
session_rel_maps: dict[str, IndependenceMap] = {}

@router.post("/completions")
async def chat_completion(request: ChatRequest, session_id: str):
    # 1. ì„¸ì…˜ì— ì¶”ì¶œ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ì¶”ì¶œ
    if session_id not in session_rel_maps:
        rel_map = await extract_relationships(request.messages[-1].content)
        session_rel_maps[session_id] = rel_map
    
    # 2. Context í™œìš©
    rel_map = session_rel_maps[session_id]
    # ... (ì˜µì…˜ Aì™€ ë™ì¼)
```

**ì¥ì **:
- ì¤‘ë³µ ì¶”ì¶œ ë°©ì§€
- ì„±ëŠ¥ ìµœì í™”

**ë‹¨ì **:
- ì„¸ì…˜ ê´€ë¦¬ ë³µì¡ë„ ì¦ê°€

### ì˜µì…˜ C: í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼

**ì ‘ê·¼**: `/independence/review` ê²°ê³¼ë¥¼ Neo4jì— ì €ì¥í•˜ê³ , `/chat`ì—ì„œ ì¡°íšŒ

**êµ¬í˜„ ë°©ì•ˆ**:
```python
@router.post("/completions")
async def chat_completion(request: ChatRequest):
    # 1. Neo4jì—ì„œ ìµœê·¼ ì¶”ì¶œ ê²°ê³¼ ì¡°íšŒ (ì‹œë‚˜ë¦¬ì˜¤ ê¸°ë°˜)
    rel_map = await get_latest_rel_map_from_neo4j(request.messages[-1].content)
    
    # 2. Context í™œìš©
    # ... (ì˜µì…˜ Aì™€ ë™ì¼)
```

**ì¥ì **:
- ë°ì´í„° ì¬ì‚¬ìš©
- ì¼ê´€ì„± ìœ ì§€

**ë‹¨ì **:
- Neo4j ì˜ì¡´ì„± ì¦ê°€

---

## ğŸ“ ê¶Œì¥ì‚¬í•­

### ì¦‰ì‹œ ì ìš© ê¶Œì¥: ì˜µì…˜ A (ê°„ë‹¨í•œ í†µí•©)

**ì´ìœ **:
1. ì˜ë„í•œ íë¦„ êµ¬í˜„
2. ê¸°ì¡´ ì½”ë“œ ìµœì†Œ ë³€ê²½
3. ë¹ ë¥¸ êµ¬í˜„ ê°€ëŠ¥

### í–¥í›„ ê°œì„ : ì˜µì…˜ B ë˜ëŠ” C

**ì´ìœ **:
1. ì„±ëŠ¥ ìµœì í™”
2. ë¹„ìš© ì ˆê°
3. ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

---

## âœ… ê²°ë¡ 

### ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ ìƒíƒœ
- âœ… ë‹¤ì´ì–´ê·¸ë¨ì€ **í˜„ì¬ êµ¬í˜„ì„ ì •í™•íˆ ë°˜ì˜**
- âŒ ë‹¤ì´ì–´ê·¸ë¨ì´ ì˜ëª» ê·¸ë ¤ì§„ ê²ƒì´ ì•„ë‹˜

### êµ¬í˜„ ìƒíƒœ
- âŒ **ì˜ë„ì™€ ë‹¤ë¥´ê²Œ êµ¬í˜„ë¨**
- `/chat`ê³¼ `/independence`ê°€ ë¶„ë¦¬ë˜ì–´ ìˆìŒ
- ì—”í‹°í‹°-ê´€ê³„ ì •ë³´ê°€ chatì˜ contextë¡œ í™œìš©ë˜ì§€ ì•ŠìŒ

### ë‹¤ìŒ ë‹¨ê³„
1. ì˜ë„í•œ íë¦„ êµ¬í˜„ (ì˜µì…˜ A ê¶Œì¥)
2. ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ ì—…ë°ì´íŠ¸ (êµ¬í˜„ í›„)
3. ì„±ëŠ¥ ìµœì í™” (ì˜µì…˜ B/C ê³ ë ¤)

---

**ê²€í†  ì™„ë£Œì¼**: 2026-02-12  
**ìƒíƒœ**: âš ï¸ êµ¬í˜„ì´ ì˜ë„ì™€ ë‹¤ë¦„ (ìˆ˜ì • í•„ìš”)
