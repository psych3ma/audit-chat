# 검토 요청 실패 원인 및 개선 — CTO 검토

**작성일**: 2026-02-23  
**검토 대상**: "검토 요청 연결에 실패했습니다. 예시 기준 결과를 표시합니다. Not Found"

---

## 1. 실패 원인 (근본 원인)

| 구분 | 내용 |
|------|------|
| **현상** | 프론트에서 `POST /independence/extract` 호출 시 **404 Not Found** 발생 → catch에서 예시 기준 결과(폴백) 표시 |
| **직접 원인** | 현재 접속한 서버에 **독립성 검토 API가 없음** |
| **구체적 상황** | `run_static_only.py`로 정적 전용 서버만 실행 중 → `/independence/extract`, `/analyze`, `/report` 라우트 미등록 → 첫 단계 extract에서 404 |

**호출 흐름**

1. `API_BASE_URL`이 비어 있음 → **same-origin** (예: `http://localhost:8765`) 사용  
2. `fetch(baseUrl + "/independence/extract", ...)` → 현재 오리진(정적 전용 서버)으로 요청  
3. 정적 전용 서버는 `/`, `/ready`, `/static`만 제공 → **404 Not Found**  
4. `toJson()`에서 `!res.ok` → `throw new Error(res.status + " " + res.statusText)` → `"404 Not Found"`  
5. `.catch()`에서 사용자 메시지 + `err.message` 노출, `renderFallbackReport()`로 예시 결과 표시  

즉, **백엔드(Full API)가 아닌 정적 전용 서버에 연결되어 있어서** 검토 요청이 실패한 것이며, 네트워크 장애나 일시 오류가 아님.

---

## 2. CTO 관점 정리

### 2.1 확장성

- **단일 오리진 가정**: `API_BASE_URL` 빈 값이면 현재 호스트를 그대로 API 베이스로 사용. 정적 전용/풀백엔드 구분이 없어, 같은 URL에 “페이지는 있지만 API는 없음”인 경우가 생김.
- **개선**: 배포 형태별로 API 베이스를 한 곳에서 관리(환경 변수 또는 빌드 시 주입). 정적 전용 모드일 때는 아예 검토 API 호출을 하지 않거나(`USE_BACKEND_API=false`), 별도 API URL을 명시하도록 하면 확장 시 혼선을 줄일 수 있음.

### 2.2 유지보수성

- **에러 메시지 산재**: "검토 요청 연결에 실패했습니다. 예시 기준 결과를 표시합니다." + `err.message`가 코드 한 곳에 하드코딩. 메시지 변경 시 검색·수정 포인트가 늘어남.
- **원인 구분 부재**: 404(API 없음), 502/503(서버 과부하), 0/CORS/네트워크 오류 등이 모두 같은 문구로만 표시되어, 운영 시 원인 파악이 어렵다.
- **개선**: 에러 메시지 상수화(SSOT), HTTP 상태별(또는 에러 타입별) 짧은 운영자용 안내 문구를 분리해 두면 유지보수와 운영 대응이 수월해짐.

### 2.3 협업/코드

- **실패 시 사용자/운영자 구분**: 사용자에게는 “연결 실패 + 예시 결과 표시”만 알리고, 404인 경우에는 “이 서버에는 검토 API가 없음” 정도의 짧은 운영자/개발자 안내를 함께 두면, 새로 합류한 개발자나 운영자가 원인을 빠르게 이해할 수 있음.
- **실행 모드 문서화**: `run_static_only.py` vs `run.sh`(풀 백엔드) 차이를 README나 운영 가이드에 한 줄씩 명시해 두면, “왜 검토만 실패하지?” 같은 질문을 줄일 수 있음.

---

## 3. 적용한 개선 (코드 반영)

- **에러 메시지 상수화**: 연결 실패 시 사용자 문구를 상수로 두어, 문구 변경 시 한 곳만 수정하도록 함.
- **404 시 운영자 안내**: `err.message`에 `404`가 포함된 경우, “이 서버에는 검토 API가 없습니다. 전체 앱은 run.sh로 실행하세요.” 같은 한 줄 안내를 추가해, 정적 전용 서버로 접속했을 때 원인을 바로 알 수 있게 함.

---

## 4. 요약

| 질문 | 답변 |
|------|------|
| **검토 요청이 왜 실패했나?** | 접속한 서버가 **정적 전용 서버**라 `/independence/*` API가 없어 **404 Not Found**가 발생했기 때문. |
| **예시 기준 결과는?** | 설계된 폴백으로, API 실패 시 사용자에게 기본 결과를 보여 주는 동작이며 적절함. |
| **다음 조치** | 풀 백엔드(Neo4j 등)가 정상인 환경에서는 `run.sh`로 실행해 동일 오리진에서 API를 제공하면 검토 요청이 성공함. 정적 전용 서버만 쓸 때는 예시 결과만 보이는 것이 정상 동작임. |
